<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/research.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

    <!-- Header Section -->
    <header class="header">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <img src="{{ url_for('static', filename='img/cslogo.png') }}" height="70" class="ms-5">
                <a class="navbar-brand ms-2" href="{{ url_for('homepage') }}">Computer Science Research</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse text-center" id="navbarSupportedContent">
                    <ul class="navbar-nav mb-2 mb-lg-0 ms-auto">
                        <li class="nav-item me-5">
                            <a href="{{ url_for('homepage') }}" class="active">Home</a>
                        </li>
                        <li class="nav-item me-5">
                            <a href="{{ url_for('research') }}" class="research">Research</a>
                        </li>
                        <li class="nav-item me-5">
                            <a href="https://www.cs.science.cmu.ac.th/" class="aboutus">About us</a>
                        </li>
                        <li class="nav-item me-5">
                            <a href="{{ url_for('contact') }}" class="contact">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Search and Filter Section -->
    <div class="container-color">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="search-section">
                    <h2 class="text-white">Research</h2>
                    <div class="row g-3 filter-section">
                        <!-- Filters -->
                        <div class="col-6 col-sm-4 col-md-2">
                            <select class="form-select" id="category">
                                <option selected value="">Category</option>
                                <option value="Web App">Web App</option>
                                <option value="Machine Learning">Machine Learning</option>
                                <option value="Image Processing">Image Processing</option>
                                <option value="Games">Games</option>
                                <option value="Data Classification">Data Classification</option>
                                <option value="Data Analysis">Data Analysis</option>
                                <option value="Database">Database</option>
                                <option value="IoT">IoT</option>
                                <option value="Network">Network</option>
                                <option value="Windows App">Windows App</option>
                                <option value="Security">Security</option>
                                <option value="Simulation">Simulation</option>
                                <option value="Data Warehouse">Data Warehouse</option>
                                <option value="Virtual Reality">Virtual Reality</option>
                                <option value="Other Categories">Other Categories</option>
                            </select>
                        </div>
                        <div class="col-6 col-sm-4 col-md-2">
                            <select class="form-select" id="degree">
                                <option selected value="">Degree</option>
                                <option value="Bachelor">Bachelor</option>
                                <option value="Master">Master</option>
                                <option value="phD">PhD</option>
                            </select>
                        </div>
                        <div class="col-6 col-sm-4 col-md-2">
                            <select class="form-select" id="type">
                                <option selected value="">Type</option>
                                <option value="204499">204499</option>
                                <option value="Co-operative">Co-operative</option>
                                <option value="Other Type">Other Type</option>
                            </select>
                        </div>
                        <div class="col-6 col-sm-4 col-md-2">
                            <select class="form-select" id="instructor">
                                <option value="" disabled selected>Instructor</option>
                                <option value="Assistant Professor Dr. Ratsameetip Wita">Assistant Professor Dr.
                                    Ratsameetip Wita</option>
                                <option value="Associate Professor Dr. Jakramate Bootkrajang">Associate Professor Dr.
                                    Jakramate Bootkrajang</option>
                                <option value="Assistant Professor Dr. Prakarn Unachak">Assistant Professor Dr. Prakarn
                                    Unachak</option>
                                <option value="Dr. Sutasinee Thovuttikul">Dr. Sutasinee Thovuttikul</option>
                                <option value="Dr. Thapanapong Rukkanchanunt">Dr. Thapanapong Rukkanchanunt</option>
                                <option value="Associate Professor Dr. Rattasit Sukhahuta">Associate Professor Dr.
                                    Rattasit Sukhahuta</option>
                                <option value="Associate Professor Dr. Ekkarat Boonchieng">Associate Professor Dr.
                                    Ekkarat Boonchieng</option>
                                <option value="Assistant Professor Dr. Dussadee Praserttitipong">Assistant Professor Dr.
                                    Dussadee Praserttitipong</option>
                                <option value="Assistant Professor Dr. Suphakit Awiphan">Assistant Professor Dr.
                                    Suphakit Awiphan</option>
                                <option value="Assistant Professor Dr. Wijak Srisujjalertwaja">Assistant Professor Dr.
                                    Wijak Srisujjalertwaja</option>
                                <option value="Dr. Worawut Srisukkham">Dr. Worawut Srisukkham</option>
                                <option value="Assistant Professor Dr. Papangkorn Inkeaw">Assistant Professor Dr.
                                    Papangkorn Inkeaw</option>
                                <option value="Assistant Professor Dr. Kornprom Pikulkaew">Assistant Professor Dr.
                                    Kornprom Pikulkaew</option>
                                <option value="Associate Professor Dr. Jeerayut Chaijaruwanich">Associate Professor Dr.
                                    Jeerayut Chaijaruwanich</option>
                                <option value="Associate Professor Dr. Chumphol Bunkhumpornpat">Associate Professor Dr.
                                    Chumphol Bunkhumpornpat</option>
                                <option value="Associate Professor Dr. Varin Chouvatut">Associate Professor Dr. Varin
                                    Chouvatut</option>
                                <option value="Associate Professor Dr. Wattana Jindaluang">Associate Professor Dr.
                                    Wattana Jindaluang</option>
                                <option value="Assistant Professor Dr. Samerkae Somhom">Assistant Professor Dr. Samerkae
                                    Somhom</option>
                                <option value="Assistant Professor Dr. Areerat Trongratsameethong">Assistant Professor
                                    Dr. Areerat Trongratsameethong</option>
                                <option value="Assistant Professor Dr. Jakarin Chawachat">Assistant Professor Dr.
                                    Jakarin Chawachat</option>
                                <option value="Assistant Professor Dr. Prapaporn Techa-Angkoon">Assistant Professor Dr.
                                    Prapaporn Techa-Angkoon</option>
                                <option value="Assistant Professor Wassana Naiyapo">Assistant Professor Wassana Naiyapo
                                </option>
                                <option value="Assistant Professor Benjamas Panyangam">Assistant Professor Benjamas
                                    Panyangam</option>
                                <option value="Noparut Vanitchanant">Noparut Vanitchanant</option>
                                <option value="Dr. Kamonphop Srisopha">Dr. Kamonphop Srisopha</option>
                                <option value="Kittipitch Kuptavanich">Kittipitch Kuptavanich</option>
                                <option value="Sitthichoke Subpaiboonkit">Sitthichoke Subpaiboonkit</option>

                            </select>
                        </div>
                        <div class="col-6 col-sm-4 col-md-2">
                            <select class="form-select" id="academicYear">
                                <option selected value="">Academic Year</option>
                                <script>
                                    const currentYear = new Date().getFullYear() + 543; // เปลี่ยนเป็นปีพุทธศักราช
                                    for (let year = currentYear; year >= 2543; year--) {
                                        document.write(`<option value="${year}">${year}</option>`);
                                    }
                                </script>
                            </select>
                        </div>
                    </div>

                    <!-- Search Input -->
                    <div class="row mt-4">
                        <div class="col-12 col-md-8">
                            <input type="text" id="searchKeyword" class="form-control"
                                placeholder="Search for projects...">
                        </div>
                        <div class="col-6 col-md-2 mt-2 mt-md-0">
                            <button class="btn btn-search w-100 text-center" type="button" onclick="performSearch()">
                                <i class="fa fa-search"></i> Search
                            </button>
                        </div>
                        <div class="col-6 col-md-2 mt-2 mt-md-0">
                            <button class="btn btn-clear w-100 text-center" type="button" onclick="clearSearch()">
                                <i class="fa fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Projects List Section -->
    <div class="row mt-5" id="projectList">
        <!-- Projects will be dynamically loaded here -->
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            // ใช้งาน Select2 เพื่อให้ dropdown มี UI ที่ใช้งานง่าย
            $('.select2').select2({
                placeholder: 'Select an option',
                allowClear: true
            });
            // ฟังก์ชันเรียกค้นหาเมื่อกดปุ่ม Enter ในช่องค้นหาหรือ dropdown
            $('#searchKeyword').on('keypress', function (e) {
                if (e.which == 13) {
                    performSearch();
                }
            });

            // ฟังก์ชันเรียกค้นหาเมื่อมีการเปลี่ยนแปลงค่าของ dropdown ใด ๆ
            $('#category, #degree, #type, #instructor, #academicYear').on('change select2:select', function () {
                performSearch(); // เรียก performSearch() เมื่อ dropdown มีการเปลี่ยนแปลงค่า
            });
        });

        function performSearch() {
            // รับค่าจาก dropdown และ input search
            const category = $('#category').val();
            const degree = $('#degree').val();
            const type = $('#type').val();
            const instructor = $('#instructor').val();
            const academicYear = $('#academicYear').val();
            const searchKeyword = $('#searchKeyword').val().trim().toLowerCase();
            console.log(category); // Debug เพื่อเช็คค่าที่ได้รับจาก dropdown

            // ส่งคำขอ AJAX ไปที่ backend เพื่อค้นหาข้อมูลที่ตรงกับฟิลเตอร์และคำค้นหา
            $.ajax({
                url: '/api/projects/search',  // URL สำหรับส่งคำขอค้นหาไปที่ backend API
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    category: category,
                    degree: degree,
                    type: type,
                    instructor: instructor,
                    academicYear: academicYear,
                    keyword: searchKeyword
                }),
                success: function (projects) {
                    // ประมวลผลและแสดงผลโปรเจคที่ค้นพบ
                    const projectList = document.getElementById('projectList');
                    projectList.innerHTML = '';

                    projects.forEach(project => {
                        const projectCard = document.createElement('div');
                        projectCard.classList.add('col-md-6', 'mb-4');

                        projectCard.innerHTML = `
    <div class="project-card border p-3 h-100" onclick="window.location.href='/readresearch/${project.encoded_project_id}';">
        <h3 class="text-center">${project.name}</h3>
        <div class="row fixed-col-size">
            <div class="col-6">
                <p><strong>Category:</strong> ${project.categories}</p>
                <p><strong>Degree:</strong> ${project.degree}</p>
                <p><strong>Type:</strong> ${project.file_types}</p>
                <p><strong>Abstract:</strong> ${project.description.length > 150 ? project.description.substring(0, 150) + "..." : project.description}</p>
            </div>
            <div class="col-6">
                <p><strong>Year:</strong> ${project.year}</p>
                <p><strong>Instructor:</strong> ${project.supervisors}</p>
            </div>
        </div>
    </div>
`;

                        projectList.appendChild(projectCard);
                    });
                },
                error: function (error) {
                    console.error('Error fetching projects:', error);
                }
            });
        }


        function clearSearch() {
            // ล้างค่าฟิลเตอร์และคำค้นหาทั้งหมด
            $('#searchKeyword').val('');
            $('#category').val('').trigger('change');
            $('#degree').val('').trigger('change');
            $('#type').val('').trigger('change');
            $('#instructor').val('').trigger('change');
            $('#academicYear').val('').trigger('change');

            // เรียกฟังก์ชันเพื่อโหลดโปรเจคทั้งหมด
            loadProjects();
        }

        function loadProjects() {
            // เรียกข้อมูลโปรเจคทั้งหมดโดยไม่ใช้ฟิลเตอร์
            $.ajax({
                url: '/api/projects',  // URL สำหรับเรียกข้อมูลโปรเจคทั้งหมด
                method: 'GET',
                success: function (projects) {
                    const projectList = document.getElementById('projectList');
                    projectList.innerHTML = '';

                    projects.forEach(project => {
                        const projectCard = document.createElement('div');
                        projectCard.classList.add('col-md-6', 'mb-4');

                        projectCard.innerHTML = `
                        <div class="project-card border p-3 h-100" onclick="window.location.href='/readresearch/${project.encoded_project_id}';">
                            <h3 class="text-center">${project.name}</h3>
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Category:</strong> ${project.categories}</p>
                                    <p><strong>Degree:</strong> ${project.degree}</p>
                                    <p><strong>Type:</strong> ${project.file_types}</p>
                                    <p><strong>Abstract:</strong> ${project.description}</p>
                                </div>
                                <div class="col-6">
                                    <p><strong>Year:</strong> ${project.year}</p>
                                    <p><strong>Instructor:</strong> ${project.supervisors}</p>
                                </div>
                            </div>
                        </div>
                    `;
                        projectList.appendChild(projectCard);
                    });
                },
                error: function (error) {
                    console.error('Error fetching projects:', error);
                }
            });
        }

        window.onload = loadProjects;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>



</html>